<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Sistema de Herramientas Organizacionales</title>
  <link rel="stylesheet" href="assets/css/main.css">
</head>

<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>ğŸ›ï¸ Sistema de Herramientas Organizacionales</h1>
      <p>Gobierno del Estado de Chihuahua</p>
    </div>

    <!-- NavegaciÃ³n -->
    <div class="nav">
      <button class="nav-btn active" onclick="mostrarVista('dashboard', event)">ğŸ“Š Reporte General</button>
      <button class="nav-btn" onclick="mostrarVista('organizaciones', event)">ğŸ¢ Dependencia/Entidad</button>
      <button class="nav-btn" onclick="mostrarVista('herramientas', event)">ğŸ“ Herramientas</button>
      <button class="nav-btn" onclick="mostrarVista('reportes', event)">ğŸ“ˆ Reportes</button>
      <button class="nav-btn logout" onclick="window.AppUtils.cerrarSesion()">ğŸšª Cerrar SesiÃ³n</button>
    </div>

    <!-- Contenedor de alertas -->
    <div id="alert-container"></div>

    <!-- Vista REPORTE GENERAL -->
    <div id="vista-dashboard">
      <h2 class="card-title mb-20">Reporte General del Sistema</h2>

      <!-- EstadÃ­sticas -->
      <div class="stats-grid" id="stats-grid">
        <div class="spinner"></div>
      </div>

      <!-- Tarjetas de informaciÃ³n -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Resumen de SemÃ¡foro</h3>
        </div>
        <div id="tabla-semaforo">
          <div class="spinner"></div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Herramientas PrÃ³ximas a Vencer</h3>
        </div>
        <div id="tabla-proximas-vencer">
          <div class="spinner"></div>
        </div>
      </div>
    </div>

    <!-- Vista Dependencias/Entidades -->
    <div id="vista-organizaciones" class="hidden">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Dependencias y Entidades</h3>
          <div id="admin-actions-organizaciones" style="display: none;">
            <button class="btn btn-primary" onclick="mostrarModal('modal-nueva-organizacion')">
              â• Nueva Dependencia/Entidad
            </button>
          </div>
        </div>

        <div class="form-group">
          <select class="form-select" id="filtro-tipo-org" onchange="cargarOrganizaciones()">
            <option value="">Todas</option>
            <option value="DEPENDENCIA">Dependencias</option>
            <option value="ENTIDAD_PARAESTATAL">Entidades Paraestatales</option>
          </select>
        </div>

        <div id="tabla-organizaciones">
          <div class="table-container">
            <table class="table">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Tipo</th>
                  <th>Titular</th>
                  <th>SemÃ¡foro</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="organizaciones-tabla-body">
                <tr>
                  <td colspan="5" class="text-center">
                    <div class="spinner"></div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Vista Herramientas -->
    <div id="vista-herramientas" class="hidden">
      <div class="layout-herramientas">
        <!-- Columna Izquierda: Lista de Dependencias -->
        <div class="card" style="flex: 1; min-width: 300px;">
          <div class="card-header">
            <h3 class="card-title">Seleccionar Dependencia</h3>
          </div>
          <div class="p-10">
            <input type="text" class="form-input mb-10" id="buscar-org-herramientas" placeholder="Buscar dependencia..."
              oninput="filtrarOrganizacionesHerramientas()">
            <div id="lista-organizaciones-herramientas" class="list-group">
              <!-- Cargado dinÃ¡micamente -->
              <div class="spinner"></div>
            </div>
          </div>
        </div>

        <!-- Columna Derecha: Detalle de Herramientas -->
        <div class="card" style="flex: 2; min-width: 400px;">
          <div class="card-header" style="justify-content: space-between;">
            <h3 class="card-title" id="titulo-dependencia-seleccionada">Herramientas</h3>
            <div id="admin-actions-herramientas" style="display: none;">
              <button class="btn btn-primary btn-sm" onclick="hacerNuevaHerramientaConOrg()">+ Nueva
                Herramienta</button>
            </div>
          </div>
          <div id="detalle-herramientas-dependencia" class="p-20">
            <div class="empty-state">
              <p>Seleccione una dependencia de la lista para ver su informaciÃ³n y herramientas.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Vista Reportes -->
    <div id="vista-reportes" class="hidden">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Reportes y Exportaciones</h3>
        </div>

        <div class="stats-grid">
          <div class="stat-card" style="cursor: pointer;" onclick="window.ReportesModule.exportarInventario()">
            <div class="stat-number" style="color: var(--azul-institucional);">ğŸ“‹</div>
            <div class="stat-label">Inventario Completo</div>
            <button class="btn btn-primary mt-20">Exportar Excel</button>
          </div>

          <div class="stat-card" style="cursor: pointer;" onclick="window.ReportesModule.exportarSemaforo()">
            <div class="stat-number" style="color: var(--morado-institucional);">ğŸš¦</div>
            <div class="stat-label">Reporte de SemÃ¡foro</div>
            <button class="btn btn-secondary mt-20">Exportar Excel</button>
          </div>

          <div class="stat-card" style="cursor: pointer;" onclick="window.ReportesModule.exportarProximasVencer()">
            <div class="stat-number" style="color: var(--amarillo-advertencia);">â°</div>
            <div class="stat-label">PrÃ³ximas a Vencer</div>
            <button class="btn btn-secondary mt-20">Exportar Excel</button>
          </div>
        </div>

        <div class="card mt-20">
          <div class="card-header">
            <h3 class="card-title">Historial de Cambios</h3>
          </div>
          <div id="tabla-historial">
            <div class="spinner"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Nueva Dependencia/Entidad -->
  <div id="modal-nueva-organizacion" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="card-title">Nueva Dependencia/Entidad</h3>
        <button class="modal-close" onclick="cerrarModal('modal-nueva-organizacion')">&times;</button>
      </div>
      <form id="form-nueva-organizacion">
        <div class="form-group">
          <label class="form-label">Nombre</label>
          <input type="text" class="form-input" name="nombre" required>
        </div>
        <div class="form-group">
          <label class="form-label">Tipo</label>
          <select class="form-select" name="tipo" required>
            <option value="">Seleccione...</option>
            <option value="DEPENDENCIA">Dependencia</option>
            <option value="ENTIDAD_PARAESTATAL">Entidad Paraestatal</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Siglas (opcional)</label>
          <input type="text" class="form-input" name="siglas">
        </div>
        <div class="form-group">
          <label class="form-label">Titular</label>
          <input type="text" class="form-input" name="titular">
        </div>
        <div class="form-group">
          <label class="form-label">Decreto de CreaciÃ³n (URL)</label>
          <input type="url" class="form-input" name="decreto_creacion" placeholder="https://...">
        </div>
        <button type="submit" class="btn btn-primary">Guardar</button>
      </form>
    </div>
  </div>

  <!-- Modal Nueva Herramienta -->
  <div id="modal-nueva-herramienta" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="card-title">Nueva Herramienta</h3>
        <button class="modal-close" onclick="cerrarModal('modal-nueva-herramienta')">&times;</button>
      </div>
      <form id="form-nueva-herramienta">
        <div class="form-group">
          <label class="form-label">Dependencia/Entidad</label>
          <select class="form-select" name="organizacion_id" id="select-organizacion" required>
            <option value="">Cargando...</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Tipo de Herramienta</label>
          <select class="form-select" name="tipo_herramienta" required>
            <option value="">Seleccione...</option>
            <option value="ORGANIGRAMA">Organigrama</option>
            <option value="REGLAMENTO_INTERIOR">Reglamento Interior</option>
            <option value="ESTATUTO_ORGANICO">Estatuto OrgÃ¡nico</option>
            <option value="MANUAL_ORGANIZACION">Manual de OrganizaciÃ³n</option>
            <option value="MANUAL_PROCEDIMIENTOS">Manual de Procedimientos</option>
            <option value="MANUAL_SERVICIOS">Manual de Servicios</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Archivo</label>
          <input type="file" class="form-input" name="archivo" required accept=".pdf,.doc,.docx,.xls,.xlsx">
        </div>
        <div class="form-group">
          <label class="form-label">Fecha de EmisiÃ³n</label>
          <input type="date" class="form-input" name="fecha_emision" required>
        </div>
        <div class="form-group">
          <label class="form-label">Fecha de PublicaciÃ³n en POE (opcional)</label>
          <input type="date" class="form-input" name="fecha_publicacion_poe">
        </div>
        <div class="form-group">
          <label class="form-label">Link de PublicaciÃ³n en POE (opcional)</label>
          <input type="url" class="form-input" name="link_publicacion_poe" placeholder="https://...">
        </div>
        <div class="form-group">
          <label class="form-label">Estatus en POE</label>
          <input type="text" class="form-input" name="estatus_poe" placeholder="Ej: PUBLICADO">
        </div>
        <div class="form-group">
          <label class="form-label">Comentarios</label>
          <textarea class="form-input" name="comentarios" rows="3"></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">VersiÃ³n</label>
          <input type="text" class="form-input" name="version" value="1.0">
        </div>
        <button type="submit" class="btn btn-primary">Guardar</button>
      </form>
    </div>
  </div>

  <!-- Modal Detalle OrganizaciÃ³n -->
  <!-- Modal Editar Dependencia/Entidad -->
  <div id="modal-editar-organizacion" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="card-title">Editar Dependencia/Entidad</h3>
        <button class="modal-close" onclick="cerrarModal('modal-editar-organizacion')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="form-editar-organizacion">
          <input type="hidden" name="id" id="edit-org-id">
          <div class="form-group">
            <label class="form-label">Nombre de la Dependencia/Entidad</label>
            <input type="text" class="form-input" name="nombre" id="edit-org-nombre" required>
          </div>
          <div class="form-group">
            <label class="form-label">Tipo</label>
            <select class="form-input" name="tipo" id="edit-org-tipo" required>
              <option value="DEPENDENCIA">Dependencia</option>
              <option value="ENTIDAD_PARAESTATAL">Entidad Paraestatal</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Siglas</label>
            <input type="text" class="form-input" name="siglas" id="edit-org-siglas">
          </div>
          <div class="form-group">
            <label class="form-label">Titular</label>
            <input type="text" class="form-input" name="titular" id="edit-org-titular">
          </div>
          <div class="form-group">
            <label class="form-label">Decreto de CreaciÃ³n (URL)</label>
            <input type="url" class="form-input" name="decreto_creacion" id="edit-org-decreto"
              placeholder="https://...">
          </div>
          <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button type="submit" class="btn btn-primary" style="flex: 1;">Guardar Cambios</button>
            <button type="button" class="btn btn-secondary" style="flex: 1;"
              onclick="cerrarModal('modal-editar-organizacion')">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div id="modal-detalle-organizacion" class="modal">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h3 class="card-title" id="detalle-org-nombre">Detalle de la Dependencia/Entidad</h3>
        <button class="modal-close" onclick="cerrarModal('modal-detalle-organizacion')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="stats-grid mb-20">
          <div class="stat-card">
            <div class="stat-label">Tipo</div>
            <div id="detalle-org-tipo" class="stat-number" style="font-size: 1.2rem; color: var(--azul-institucional);">
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-label">SemÃ¡foro</div>
            <div id="detalle-org-semaforo" class="stat-number" style="font-size: 1.2rem;"></div>
          </div>
        </div>

        <div class="card mb-20">
          <div class="card-header">
            <h4 class="card-title">InformaciÃ³n General</h4>
          </div>
          <div class="p-20">
            <p><strong>Titular:</strong> <span id="detalle-org-titular"></span></p>
            <p><strong>Siglas:</strong> <span id="detalle-org-siglas"></span></p>
            <p id="container-decreto"><strong>Decreto de CreaciÃ³n:</strong> <a id="detalle-org-decreto" href="#"
                target="_blank" class="btn btn-secondary btn-sm" style="display: inline-block; margin-left: 10px;">Ver
                Documento ğŸ”—</a></p>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h4 class="card-title">Herramientas Registradas</h4>
          </div>
          <div id="detalle-org-herramientas-lista">
            <div class="spinner"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="assets/js/utils.js"></script>
  <script src="assets/js/auth.js"></script>
  <script src="assets/js/organizaciones.js"></script>
  <script src="assets/js/herramientas.js"></script>
  <script src="assets/js/reportes.js"></script>
  <script src="assets/js/app.js"></script>
</body>

</html>
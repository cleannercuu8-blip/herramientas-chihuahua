<!-- Build Tag: 2026-02-10 14:18 -->
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Sistema de Herramientas Organizacionales</title>
  <link rel="stylesheet" href="assets/css/main.css">
</head>

<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>üèõÔ∏è Sistema de Herramientas Organizacionales</h1>
      <p>Gobierno del Estado de Chihuahua</p>

      <!-- Men√∫ de Usuario -->
      <div class="user-menu-container">
        <div class="profile-trigger" onclick="mostrarModalPerfil()">
          <div class="profile-avatar" id="user-avatar-initials">?</div>
          <div class="profile-info">
            <span class="profile-name" id="user-display-name">Usuario</span>
            <span class="profile-role" id="user-display-role">Cargando...</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Navegaci√≥n -->
    <div class="nav">
      <button class="nav-btn active" onclick="mostrarVista('organizaciones', event)">üè¢ Dependencia/Entidad</button>
      <button class="nav-btn" onclick="mostrarVista('herramientas', event)">üìÅ Herramientas</button>
      <button class="nav-btn" onclick="mostrarVista('dashboard', event)">üìä Reporte General</button>
      <button class="nav-btn" onclick="mostrarVista('reportes', event)">üì• Exportar</button>
      <button class="nav-btn" id="nav-btn-usuarios" style="display: none;" onclick="mostrarVista('usuarios', event)">üë•
        Usuarios</button>
      <button class="nav-btn logout" onclick="window.AppUtils.cerrarSesion()">üö™ Cerrar Sesi√≥n</button>
    </div>

    <!-- Contenedor de alertas -->
    <div id="alert-container"></div>

    <!-- Vista REPORTE GENERAL -->
    <div id="vista-dashboard" class="hidden">
      <h2 class="card-title mb-20">Reporte General del Sistema</h2>

      <!-- Estad√≠sticas -->
      <div class="stats-grid" id="stats-grid">
        <div class="spinner"></div>
      </div>

      <!-- Tarjetas de informaci√≥n -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Resumen de Sem√°foro</h3>
        </div>
        <div id="tabla-semaforo">
          <div class="spinner"></div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Herramientas Pr√≥ximas a Vencer</h3>
        </div>
        <div id="tabla-proximas-vencer">
          <div class="spinner"></div>
        </div>
      </div>
    </div>

    <!-- Vista Dependencias/Entidades -->
    <div id="vista-organizaciones">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Dependencias y Entidades</h3>
          <div id="admin-actions-organizaciones" style="display: none;">
            <button class="btn btn-primary" onclick="mostrarModal('modal-nueva-organizacion')">
              ‚ûï Nueva Dependencia/Entidad
            </button>
          </div>
        </div>

        <div class="form-group">
          <select class="form-select" id="filtro-tipo-org" onchange="cargarOrganizaciones()">
            <option value="">Todas</option>
            <option value="DEPENDENCIA">Dependencias</option>
            <option value="ENTIDAD_PARAESTATAL">Entidades Paraestatales</option>
          </select>
        </div>

        <div id="tabla-organizaciones">
          <div class="table-container">
            <table class="table">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Tipo</th>
                  <th>Titular</th>
                  <th>Sem√°foro</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="organizaciones-tabla-body">
                <tr>
                  <td colspan="5" class="text-center">
                    <div class="spinner"></div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Vista Herramientas -->
    <div id="vista-herramientas" class="hidden">
      <div class="layout-herramientas">
        <!-- Columna Izquierda: Lista de Dependencias -->
        <div class="card" style="flex: 1; min-width: 300px;">
          <div class="card-header">
            <h3 class="card-title">Seleccionar Dependencia</h3>
          </div>
          <div class="p-10">
            <input type="text" class="form-input mb-10" id="buscar-org-herramientas" placeholder="Buscar dependencia..."
              oninput="filtrarOrganizacionesHerramientas()">
            <div id="lista-organizaciones-herramientas" class="list-group">
              <!-- Cargado din√°micamente -->
              <div class="spinner"></div>
            </div>
          </div>
        </div>

        <!-- Columna Derecha: Detalle de Herramientas -->
        <div class="card" style="flex: 2; min-width: 400px;">
          <div class="card-header" style="justify-content: space-between;">
            <h3 class="card-title" id="titulo-dependencia-seleccionada">Herramientas</h3>
            <div id="admin-actions-herramientas" style="display: none;">
              <button class="btn btn-primary btn-sm" onclick="hacerNuevaHerramientaConOrg()">+ Nueva
                Herramienta</button>
            </div>
          </div>
          <div id="detalle-herramientas-dependencia" class="p-20">
            <div class="empty-state">
              <p>Seleccione una dependencia de la lista para ver su informaci√≥n y herramientas.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Vista Reportes -->
    <div id="vista-reportes" class="hidden">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Reportes y Exportaciones</h3>
        </div>

        <div class="stats-grid">
          <div class="stat-card" style="cursor: pointer;" onclick="window.ReportesModule.exportarInventario()">
            <div class="stat-number" style="color: var(--azul-institucional);">üìã</div>
            <div class="stat-label">Inventario Completo</div>
            <button class="btn btn-primary mt-20">Exportar Excel</button>
          </div>

          <div class="stat-card" style="cursor: pointer;" onclick="window.ReportesModule.exportarSemaforo()">
            <div class="stat-number" style="color: var(--morado-institucional);">üö¶</div>
            <div class="stat-label">Reporte de Sem√°foro</div>
            <button class="btn btn-secondary mt-20">Exportar Excel</button>
          </div>

          <div class="stat-card" style="cursor: pointer;" onclick="window.ReportesModule.exportarProximasVencer()">
            <div class="stat-number" style="color: var(--amarillo-advertencia);">‚è∞</div>
            <div class="stat-label">Pr√≥ximas a Vencer</div>
            <button class="btn btn-secondary mt-20">Exportar Excel</button>
          </div>
        </div>

        <div class="card mt-20">
          <div class="card-header">
            <h3 class="card-title">Historial de Cambios</h3>
          </div>
          <div id="tabla-historial">
            <div class="spinner"></div>
          </div>
        </div>

        <div id="admin-maintenance-section" class="card mt-20"
          style="display: none; border: 1px solid #ffccd5; background: #fff5f5;">
          <div class="card-header">
            <h3 class="card-title" style="color: #d32f2f;">‚öôÔ∏è Mantenimiento del Sistema</h3>
          </div>
          <div class="p-20">
            <p class="mb-20"><strong>Zona de Peligro:</strong> Esta acci√≥n eliminar√° permanentemente todas las
              dependencias, herramientas e historial de cambios. El usuario administrador no ser√° eliminado.</p>
            <button class="btn" style="background-color: #d32f2f; color: white;" onclick="window.resetearBaseDeDatos()">
              Eliminar Todo y Empezar de Cero
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Nueva Dependencia/Entidad -->
  <div id="modal-nueva-organizacion" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="card-title">Nueva Dependencia/Entidad</h3>
        <button class="modal-close" onclick="cerrarModal('modal-nueva-organizacion')">&times;</button>
      </div>
      <form id="form-nueva-organizacion">
        <div class="form-group">
          <label class="form-label">Nombre</label>
          <input type="text" class="form-input" name="nombre" required>
        </div>
        <div class="form-group">
          <label class="form-label">Tipo</label>
          <select class="form-select" name="tipo" required>
            <option value="">Seleccione...</option>
            <option value="DEPENDENCIA">Dependencia</option>
            <option value="ENTIDAD_PARAESTATAL">Entidad Paraestatal</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Siglas (opcional)</label>
          <input type="text" class="form-input" name="siglas">
        </div>
        <div class="form-group">
          <label class="form-label">Titular</label>
          <input type="text" class="form-input" name="titular">
        </div>
        <div class="form-group">
          <label class="form-label">Decreto de Creaci√≥n (URL)</label>
          <input type="url" class="form-input" name="decreto_creacion" placeholder="https://...">
        </div>
        <button type="submit" class="btn btn-primary">Guardar</button>
      </form>
    </div>
  </div>

  <!-- Modal Nueva Herramienta -->
  <div id="modal-nueva-herramienta" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="card-title">Nueva Herramienta</h3>
        <button class="modal-close" onclick="cerrarModal('modal-nueva-herramienta')">&times;</button>
      </div>
      <form id="form-nueva-herramienta">
        <div class="form-group">
          <label class="form-label">Dependencia/Entidad</label>
          <select class="form-select" name="organizacion_id" id="select-organizacion" required>
            <option value="">Cargando...</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Tipo de Herramienta</label>
          <select class="form-select" name="tipo_herramienta" required>
            <option value="">Seleccione...</option>
            <option value="ORGANIGRAMA">Organigrama</option>
            <option value="REGLAMENTO_INTERIOR">Reglamento Interior</option>
            <option value="ESTATUTO_ORGANICO">Estatuto Org√°nico</option>
            <option value="MANUAL_ORGANIZACION">Manual de Organizaci√≥n</option>
            <option value="MANUAL_PROCEDIMIENTOS">Manual de Procedimientos</option>
            <option value="MANUAL_SERVICIOS">Manual de Servicios</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Link de consulta (Drive, Sitio Web, etc.)</label>
          <input type="url" class="form-input" name="link_publicacion_poe" placeholder="https://..." required>
        </div>
        <div class="form-group">
          <label class="form-label">Archivo PDF/Excel/Img (Opcional)</label>
          <input type="file" class="form-input" name="archivo" accept=".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg">
        </div>
        <div class="form-group">
          <label class="form-label">Fecha del Documento</label>
          <input type="date" class="form-input" name="fecha_emision" required>
        </div>
        <div class="form-group">
          <label class="form-label">Estatus en POE</label>
          <input type="text" class="form-input" name="estatus_poe" placeholder="Ej: PUBLICADO">
        </div>
        <div class="form-group">
          <label class="form-label">Comentarios</label>
          <textarea class="form-input" name="comentarios" rows="3"></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Versi√≥n</label>
          <input type="text" class="form-input" name="version" value="1.0">
        </div>
        <button type="submit" class="btn btn-primary">Guardar</button>
      </form>
    </div>
  </div>

  <!-- Modal EDITAR HERRAMIENTA -->
  <div id="modal-editar-herramienta" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="card-title">Editar Herramienta</h3>
        <button class="modal-close" onclick="cerrarModal('modal-editar-herramienta')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="form-editar-herramienta" onsubmit="window.guardarCambiosHerramienta(event)">
          <input type="hidden" name="id" id="edit-herramienta-id">
          <input type="hidden" name="organizacion_id" id="edit-herramienta-org-id">

          <div class="form-group">
            <label class="form-label">Tipo de Herramienta</label>
            <select class="form-select" name="tipo_herramienta" id="edit-herramienta-tipo" required>
              <option value="ORGANIGRAMA">Organigrama</option>
              <option value="REGLAMENTO_INTERIOR">Reglamento Interior</option>
              <option value="ESTATUTO_ORGANICO">Estatuto Org√°nico</option>
              <option value="MANUAL_ORGANIZACION">Manual de Organizaci√≥n</option>
              <option value="MANUAL_PROCEDIMIENTOS">Manual de Procedimientos</option>
              <option value="MANUAL_SERVICIOS">Manual de Servicios</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Link de consulta (Drive, Sitio Web, etc.)</label>
            <input type="url" class="form-input" name="link_publicacion_poe" id="edit-herramienta-link" required>
          </div>
          <div class="form-group">
            <label class="form-label">Archivo PDF/Excel (Opcional - Reemplaza anterior)</label>
            <input type="file" class="form-input" name="archivo" accept=".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg">
          </div>
          <div class="form-group">
            <label class="form-label">Fecha de publicaci√≥n</label>
            <input type="date" class="form-input" name="fecha_emision" id="edit-herramienta-fecha" required>
          </div>
          <div class="form-group">
            <label class="form-label">Estatus en POE</label>
            <input type="text" class="form-input" name="estatus_poe" id="edit-herramienta-estatus">
          </div>
          <div class="form-group">
            <label class="form-label">Comentarios</label>
            <textarea class="form-input" name="comentarios" id="edit-herramienta-comentarios" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Versi√≥n</label>
            <input type="text" class="form-input" name="version" id="edit-herramienta-version">
          </div>
          <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
            <button type="submit" class="btn btn-primary" style="flex: 1;">Actualizar Herramienta</button>
            <button type="button" class="btn btn-secondary" style="flex: 1;"
              onclick="cerrarModal('modal-editar-herramienta')">Cancelar</button>
            <button type="button" class="btn btn-danger" style="flex: 1; background-color: var(--rojo-semaforo);"
              onclick="borrarHerramientaDefinitivamente()">Eliminar</button>
          </div>
        </form>
      </div>
      <!-- Vista Usuarios (Admin Only) -->
      <div id="vista-usuarios" class="hidden">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Administraci√≥n de Usuarios</h3>
            <button class="btn btn-primary" onclick="mostrarModal('modal-nuevo-usuario')">‚ûï Nuevo Usuario</button>
          </div>
          <div class="table-container">
            <table class="table">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Email</th>
                  <th>Rol</th>
                  <th>Estado</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="usuarios-tabla-body">
                <tr>
                  <td colspan="5" class="text-center">
                    <div class="spinner"></div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>

    <!-- Modal MI PERFIL -->
    <div id="modal-perfil" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="card-title">Mi Perfil</h3>
          <button class="modal-close" onclick="cerrarModal('modal-perfil')">&times;</button>
        </div>
        <div class="modal-body">
          <div class="card mb-20" style="background: var(--gris-claro);">
            <div class="p-20 text-center">
              <div class="profile-avatar" style="width: 80px; height: 80px; font-size: 2rem; margin: 0 auto 15px;">üë§
              </div>
              <h4 id="perfil-nombre" class="mb-5">Cargando...</h4>
              <p id="perfil-email" class="text-muted mb-10">...</p>
              <span id="perfil-rol-badge" class="badge">...</span>
            </div>
          </div>

          <h4 class="mb-15">Cambiar Contrase√±a</h4>
          <form onsubmit="window.handleCambioPassword(event)">
            <div class="form-group">
              <label class="form-label">Contrase√±a Actual</label>
              <input type="password" class="form-input" id="pwd-actual" required>
            </div>
            <div class="form-group">
              <label class="form-label">Nueva Contrase√±a</label>
              <input type="password" class="form-input" id="pwd-nuevo" required minlength="6">
            </div>
            <button type="submit" class="btn btn-primary w-100">Actualizar Contrase√±a</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Modal NUEVO/EDITAR USUARIO -->
    <div id="modal-usuario-admin" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="card-title" id="usuario-modal-title">Registrar Usuario</h3>
          <button class="modal-close" onclick="cerrarModal('modal-usuario-admin')">&times;</button>
        </div>
        <div class="modal-body">
          <form id="form-usuario-admin" onsubmit="window.handleGuardarUsuario(event)">
            <input type="hidden" id="admin-user-id">
            <div class="form-group">
              <label class="form-label">Nombre Completo</label>
              <input type="text" class="form-input" name="nombre_completo" id="admin-user-nombre" required>
            </div>
            <div class="form-group">
              <label class="form-label">Correo Electr√≥nico</label>
              <input type="email" class="form-input" name="email" id="admin-user-email" required>
            </div>
            <div class="form-group" id="container-pwd-admin">
              <label class="form-label">Contrase√±a</label>
              <input type="password" class="form-input" name="password" id="admin-user-pwd" minlength="4">
              <small class="text-muted">Si est√°s editando, deja en blanco para no cambiar.</small>
            </div>
            <div class="form-group">
              <label class="form-label">Rol</label>
              <select class="form-select" name="rol" id="admin-user-rol" required>
                <option value="CAPTURISTA">Capturista (Registro y Edici√≥n)</option>
                <option value="CONSULTOR">Consultor (Solo Lectura)</option>
                <option value="ADMINISTRADOR">Administrador (Control Total)</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Estado</label>
              <select class="form-select" name="activo" id="admin-user-activo">
                <option value="1">Activo</option>
                <option value="0">Inactivo</option>
              </select>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
              <button type="submit" class="btn btn-primary" style="flex: 1;">Guardar Usuario</button>
              <button type="button" class="btn btn-secondary" style="flex: 1;"
                onclick="cerrarModal('modal-usuario-admin')">Cancelar</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- Modal Editar Dependencia/Entidad -->
    <div id="modal-editar-organizacion" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="card-title">Editar Dependencia/Entidad</h3>
          <button class="modal-close" onclick="cerrarModal('modal-editar-organizacion')">&times;</button>
        </div>
        <div class="modal-body">
          <form id="form-editar-organizacion">
            <input type="hidden" name="id" id="edit-org-id">
            <div class="form-group">
              <label class="form-label">Nombre de la Dependencia/Entidad</label>
              <input type="text" class="form-input" name="nombre" id="edit-org-nombre" required>
            </div>
            <div class="form-group">
              <label class="form-label">Tipo</label>
              <select class="form-input" name="tipo" id="edit-org-tipo" required>
                <option value="DEPENDENCIA">Dependencia</option>
                <option value="ENTIDAD_PARAESTATAL">Entidad Paraestatal</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Siglas</label>
              <input type="text" class="form-input" name="siglas" id="edit-org-siglas">
            </div>
            <div class="form-group">
              <label class="form-label">Titular</label>
              <input type="text" class="form-input" name="titular" id="edit-org-titular">
            </div>
            <div class="form-group">
              <label class="form-label">Decreto de Creaci√≥n (URL)</label>
              <input type="url" class="form-input" name="decreto_creacion" id="edit-org-decreto"
                placeholder="https://...">
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
              <button type="submit" class="btn btn-primary" style="flex: 1;">Guardar Cambios</button>
              <button type="button" class="btn btn-secondary" style="flex: 1;"
                onclick="cerrarModal('modal-editar-organizacion')">Cancelar</button>
              <button type="button" id="btn-eliminar-organizacion" class="btn btn-danger"
                style="flex: 1; display: none; background-color: var(--rojo-semaforo);"
                onclick="borrarOrganizacionDefinitivamente()">Eliminar Definitivamente</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div id="modal-detalle-organizacion" class="modal">
      <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
          <h3 class="card-title" id="detalle-org-nombre">Detalle de la Dependencia/Entidad</h3>
          <button class="modal-close" onclick="cerrarModal('modal-detalle-organizacion')">&times;</button>
        </div>
        <div class="modal-body">
          <div class="stats-grid mb-20">
            <div class="stat-card">
              <div class="stat-label">Tipo</div>
              <div id="detalle-org-tipo" class="stat-number"
                style="font-size: 1.2rem; color: var(--azul-institucional);">
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Sem√°foro</div>
              <div id="detalle-org-semaforo" class="stat-number" style="font-size: 1.2rem;"></div>
            </div>
          </div>

          <div class="card mb-20">
            <div class="card-header">
              <h4 class="card-title">Informaci√≥n General</h4>
            </div>
            <div class="p-20">
              <p><strong>Titular:</strong> <span id="detalle-org-titular"></span></p>
              <p><strong>Siglas:</strong> <span id="detalle-org-siglas"></span></p>
              <p id="container-decreto"><strong>Decreto de Creaci√≥n:</strong> <a id="detalle-org-decreto" href="#"
                  target="_blank" class="btn btn-secondary btn-sm" style="display: inline-block; margin-left: 10px;">Ver
                  Documento üîó</a></p>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h4 class="card-title">Herramientas Registradas</h4>
            </div>
            <div id="detalle-org-herramientas-lista">
              <div class="spinner"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/utils.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/organizaciones.js"></script>
    <script src="assets/js/herramientas.js"></script>
    <script src="assets/js/reportes.js"></script>
    <script src="assets/js/usuarios.js"></script>
    <script src="assets/js/app.js"></script>
</body>

</html>